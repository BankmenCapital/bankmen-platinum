<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bankmen Admin - Missions & Raffles</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #111; color: white; font-family: sans-serif; }
    .card { background: #222; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; }
    button { background: #fbbf24; color: black; padding: 0.5rem 1rem; border-radius: 9999px; font-weight: bold; transition: all 0.2s; }
    button:hover { background: #f59e0b; }
    .approve { background: #10b981; color: white; }
    .deny { background: #ef4444; color: white; }
  </style>
</head>
<body class="p-8">
  <h1 class="text-3xl font-bold mb-6">Bankmen Admin Dashboard</h1>

  <!-- Tabs -->
  <div class="mb-6">
    <button onclick="showTab('missions')" class="px-4 py-2 bg-blue-600 rounded-l-md">Missions</button>
    <button onclick="showTab('raffles')" class="px-4 py-2 bg-gray-600 rounded-r-md">Raffles</button>
  </div>

  <!-- Missions Tab -->
  <div id="missions-tab" class="space-y-4">
    <h2 class="text-xl font-bold mb-4">Mission Submissions</h2>
    <div id="missions-list"></div>
  </div>

  <!-- Raffles Tab -->
  <div id="raffles-tab" class="space-y-4 hidden">
    <h2 class="text-xl font-bold mb-4">Raffle Entries</h2>
    <div class="flex gap-2 mb-4">
      <input id="raffle-item" placeholder="Item name (e.g. socks, polo)" class="p-2 bg-gray-700 rounded text-white">
      <button onclick="loadRaffle()" class="px-4 py-2 bg-indigo-600 rounded">Load</button>
    </div>
    <div id="raffle-list"></div>
  </div>

  <script>
  const ADMIN_KEY = "4924049830";
  const BASE_URL = "https://nft-dashboard-verifier.bankmen-verifier.workers.dev";

  async function loadMissions() {
    try {
      const res = await fetch(`${BASE_URL}/missions`);
      const queue = await res.json();
      const list = document.getElementById('missions-list');
      list.innerHTML = queue.length > 0 ? queue.map(m => `
        <div class="card flex justify-between items-center">
          <div>
            <strong>${m.wallet.slice(0,8)}...</strong><br>
            <span class="text-blue-400">@${m.twitter || '???'}</span><br>
            <a href="${m.url}" target="_blank" class="text-cyan-400 hover:underline">View Post</a>
          </div>
          <div class="space-x-2">
            <button data-wallet="${m.wallet}" data-mission="${m.mission}" data-xp="${m.xp || 50}" class="approve px-3 py-1 rounded">+${m.xp || 50}</button>
            <button data-wallet="${m.wallet}" data-mission="${m.mission}" class="deny px-3 py-1 rounded">Deny</button>
          </div>
        </div>
      `).join('') : '<p class="text-gray-400 text-center">No pending missions</p>';

      // Attach event listeners
      document.querySelectorAll('.approve').forEach(btn => {
        btn.onclick = () => {
          const w = btn.dataset.wallet;
          const m = btn.dataset.mission;
          const xp = btn.dataset.xp;
          approveMission(w, m, xp);
        };
      });
      document.querySelectorAll('.deny').forEach(btn => {
        btn.onclick = () => denyMission(btn.dataset.wallet, btn.dataset.mission);
      });

    } catch (e) {
      document.getElementById('missions-list').innerHTML = '<p class="text-red-400">Error</p>';
    }
  }

  async function approveMission(wallet, mission, xp) {
    await fetch(`${BASE_URL}/approve-mission`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-Admin-Key': ADMIN_KEY },
      body: JSON.stringify({ wallet, mission, xp })
    });
    loadMissions();
  }

  async function denyMission(wallet, mission) {
    await fetch(`${BASE_URL}/deny-mission`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-Admin-Key': ADMIN_KEY },
      body: JSON.stringify({ wallet, mission })
    });
    loadMissions();
  }

  loadMissions();
  setInterval(loadMissions, 10000);
</script>
</body>
</html>
